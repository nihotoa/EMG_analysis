function takeiprint_btc
tic;


folders = {...
    'C:\data\tcohtrig\AobaT00101\control\070123',...
    'C:\data\tcohtrig\AobaT00201\control_combine\070123',...
    'C:\data\tcohtrig\AobaT00203\control\070123',...
    'C:\data\tcohtrig\AobaT00301\control\070123',...
    'C:\data\tcohtrig\AobaT00302\control_combine\070123',...
    'C:\data\tcohtrig\AobaT00304\control_combine\070123',...
    'C:\data\tcohtrig\AobaT00401\control\070123',...
    'C:\data\tcohtrig\AobaT00402\control\070123',...
    'C:\data\tcohtrig\AobaT00403\control_combine\070123',...
    'C:\data\tcohtrig\AobaT00405\control\070123',...    'C:\data\tcohtrig\AobaT00501\control\070123',...
    'C:\data\tcohtrig\AobaT00502\control\070123',...
    'C:\data\tcohtrig\AobaT00503\control\070123',...
    'C:\data\tcohtrig\AobaT00601\control\070123',...
    'C:\data\tcohtrig\AobaT00602\control\070123',...
    'C:\data\tcohtrig\AobaT00603\control\070123',...
    'C:\data\tcohtrig\AobaT00607\control_combine\070123',...
    'C:\data\tcohtrig\AobaT00701\control\070123',...
    'C:\data\tcohtrig\AobaT00702\control\070123',...
    'C:\data\tcohtrig\AobaT00801\control\070123',...
    'C:\data\tcohtrig\AobaT00805\control\070123',...
    'C:\data\tcohtrig\AobaT00808\control\070123',...
    'C:\data\tcohtrig\AobaT00809\control\070123',...
    'C:\data\tcohtrig\AobaT00812\control\070123',...
    'C:\data\tcohtrig\AobaT00901\control\070123',...
    'C:\data\tcohtrig\AobaT00902\control\070123',...
    'C:\data\tcohtrig\AobaT00903\control_combine\070123',...
    'C:\data\tcohtrig\AobaT00907\control_combine\070123',...    'C:\data\tcohtrig\AobaT00914\control\070123',...    'C:\data\tcohtrig\AobaT01002\control\070123',...
    'C:\data\tcohtrig\AobaT01101\control\070123',...
    'C:\data\tcohtrig\AobaT01105\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01108\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01114\control_combine\070123',...'C:\data\tcohtrig\AobaT01117\control\070123',...
    'C:\data\tcohtrig\AobaT01201\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01203\control\070123',...
    'C:\data\tcohtrig\AobaT01204\control\070123',...
    'C:\data\tcohtrig\AobaT01301\control\070123',...
    'C:\data\tcohtrig\AobaT01304\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01305\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01307\control\070123',...
    'C:\data\tcohtrig\AobaT01313\control\070123',...
    'C:\data\tcohtrig\AobaT01315\control\070123',...
    'C:\data\tcohtrig\AobaT01401\control\070123',...
    'C:\data\tcohtrig\AobaT01402\control\070123',...    'C:\data\tcohtrig\AobaT01501\control\070123',...
    'C:\data\tcohtrig\AobaT01601\control\070123',...
    'C:\data\tcohtrig\AobaT01602\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01603\control\070123',...
    'C:\data\tcohtrig\AobaT01604\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01605\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01701\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01702\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01711\control\070123',...
    'C:\data\tcohtrig\AobaT01712\control\070123',...
    'C:\data\tcohtrig\AobaT01801\control\070123',...
    'C:\data\tcohtrig\AobaT01802\control\070123',...
    'C:\data\tcohtrig\AobaT01804\control\070123',...
    'C:\data\tcohtrig\AobaT01901\control\070123',...
    'C:\data\tcohtrig\AobaT01904\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01906\control_combine\070123',...
    'C:\data\tcohtrig\AobaT01911\control\070123',...    'C:\data\tcohtrig\AobaT01913\control\070123',...    'C:\data\tcohtrig\AobaT02001\control_combine\070123',...    'C:\data\tcohtrig\AobaT02002\control\070123',...
    'C:\data\tcohtrig\AobaT02101\control\070123',...
    'C:\data\tcohtrig\AobaT02102\control\070123',...
    'C:\data\tcohtrig\AobaT02103\control\070123',...
    'C:\data\tcohtrig\AobaT02104\control\070123',...
    'C:\data\tcohtrig\AobaT02105\control_combine\070123',...    'C:\data\tcohtrig\AobaT02202\control\070123',...    'C:\data\tcohtrig\AobaT02301\control\070123',...
    'C:\data\tcohtrig\AobaT02302\control\070123',...
    'C:\data\tcohtrig\AobaT02401\control_combine\070123',...
    'C:\data\tcohtrig\AobaT02403\control\070123',...
    'C:\data\tcohtrig\AobaT02404\control\070123',...
    'C:\data\tcohtrig\AobaT02405\control_combine\070123',...
    'C:\data\tcohtrig\AobaT02501\control\070123',...
    'C:\data\tcohtrig\AobaT02502\control\070123',...    'C:\data\tcohtrig\AobaT02503\control\070123'
    };
folders = {'C:\data\tcohtrig\AobaT00907\control\070123'};

files   = {'Non-filtered-subsample__AbDM-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__AbPB-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__AbPL-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__ADP-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__BB-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__BRD-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__ECRb-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__ECRl-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__ECU-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__ED23-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__ED45-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__EDC-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__FCR-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__FCU-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__FDI-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__FDPr-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__FDPu-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__FDS-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__PL-subsample_070123_256_128pts_t2s.mat',...
    'Non-filtered-subsample__PT-subsample_070123_256_128pts_t2s.mat'};
names   = {'AbDM-subsample',...
    'AbPB-subsample',...
    'AbPL-subsample',...
    'ADP-subsample',...
    'BB-subsample',...
    'BRD-subsample',...
    'ECRb-subsample',...
    'ECRl-subsample',...
    'ECU-subsample',...
    'ED23-subsample',...
    'ED45-subsample',...
    'EDC-subsample',...
    'FCR-subsample',...
    'FCU-subsample',...
    'FDI-subsample',...
    'FDPr-subsample',...
    'FDPu-subsample',...
    'FDS-subsample',...
    'PL-subsample',...
    'PT-subsample'};

% files   = {'Non-filtered-subsample__AbDM-subsample_070123_256_128pts_t2s.mat',...
%     'Non-filtered-subsample__AbPB-subsample_070123_256_128pts_t2s.mat',...
%     'Non-filtered-subsample__AbPL-subsample_070123_256_128pts_t2s.mat'};

fig     = basefigure;
htitle  = uicontrol(fig,'BackgroundColor',[1 1 1],...
    'Style','text',...
    'HorizontalAlignment','center',...
    'Units','normalized',...
    'Position',[0.01 0.0 0.98 0.03],...
    'String',[]);
roifreq    = [3 125];
roitime    = [-3.072 1.024];
Trigger ='EndHold';
hh  =0;


for ii=1:length(folders)
    try
        for jj=1:length(files)
            S   =load([folders{ii},'\',files{jj}]);
            Selected = getfield(S,Trigger);
            freq    = Selected.compiled.f(:,1);

            h   = subplot(4,5,jj,'Parent',fig);
            plot(h,freq,Selected.compiled.f(:,4),'-k','LineWidth',0.75);
            hold(h,'on')
            sig = Selected.compiled.f(:,4) > Selected.compiled.cl.ch_c95;
            plot(h,freq(sig),Selected.compiled.f(sig,4),'ob','MarkerFaceColor','b','MarkerSize',3);
            line(freq,ones(size(freq))*Selected.compiled.cl.ch_c95,'Parent',h,'Color',[0.5 0.5 0.5])
            line([10 55 65 115 125;10 55 65 115 125],[get(h,'YLim')',get(h,'YLim')',get(h,'YLim')',get(h,'YLim')',get(h,'YLim')',],'Parent',h,'Color',[0.5 0.5 0.5])
            set(h,   'Box', 'off',...
                'TickDir', 'out',...
                'TickDirMode', 'manual',...
                'xlim',roifreq,...
                'XTickLabelMode', 'Auto')
            title(names{jj},'Parent',h)
            if(mod(jj,5)==1)
                ylabel(h,'Coherence')
            end
            if(jj>=16)
                xlabel(h,'Frequency (Hz)')
            end
            hold(h,'off')
        end
        set(htitle,'String',{folders{ii};['256_128pts_t2s','   cl(95%) = ',num2str(Selected.compiled.cl.ch_c95),'   n = ',num2str(Selected.timecoarse.cl.seg_tot)]})
        disp([num2str(ii),'/',num2str(length(folders)),' ',folders{ii},' at ',num2str(toc),' (sec)'])
        print(fig)
    catch
        kk  = kk+1;

        disp(['**** takeiprint_btc error: error occurred in ',folders{ii}]);
        errorfiles{kk}  = folders{ii};
    end
end
close(fig)
if hh~=0;
    disp({['Following ',num2str(hh),' files have not been created.'],' ',errorfiles{:}}')
    errordlg({['Following ',num2str(hh),' files have not been created.'],' ',errorfiles{:}})
end

function fig    = basefigure
fig = figure('Name','T-viewer',...
    'Numbertitle','off',...
    'PaperUnits' ,'centimeters',...
    'PaperOrientation' , 'landscape',...
    'PaperPosition' , [0.634517 0.737732 28.4084 19.5086],...
    'PaperPositionMode' , 'manual',...
    'PaperSize', [29.6774 20.984],...
    'PaperType','a4letter',...
    'Units' , 'pixels',...
    'Position' , [-3 83 1280 879],...
    'ToolBar' , 'figure');
